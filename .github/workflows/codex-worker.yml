name: Codex Worker

on:
  push:
    branches: [main]
    paths:
      - .flow/task.md
      - .flow/plan.md
      - .flow/decision.md

jobs:
  codex:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4

      # 这里用 Codex Action 来读取 task/plan/decision 并按约束改代码、写 execution.log、开 PR
      - uses: openai/codex-action@v1
        with:
          prompt: |
            Read .flow/task.md, .flow/plan.md, .flow/decision.md.
            Modify code strictly according to .flow/plan.md and constraints in .flow/decision.md.
            Only change src/app.js.
            Append a short log of what you changed into .codex/execution.log.
            Create a pull request with a clear title and description referencing the tasks.
